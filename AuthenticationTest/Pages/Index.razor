@page "/"
@using Npgsql
@using System.Data
@using AuthenticationTest.Areas.Identity
@using AuthenticationTest.Data
@using Microsoft.AspNetCore.Http
@using Microsoft.AspNetCore.Identity
@using Microsoft.EntityFrameworkCore
@inject IDAOFetcher _daoFetcher
@inject AuthenticationStateProvider auth

<h1>Hello, world!</h1>

Welcome to your new app.

<SurveyPrompt Title="How is Blazor working for you?"/>

@code
{
    protected override async Task OnInitializedAsync()
    {
        ifAuthenticated();
        test();
    }

    private void ifAuthenticated()
    {
        // We check if the user is logged in
        bool isAuthenticated = auth.GetAuthenticationStateAsync().Result.User.Identity.IsAuthenticated;

        if (isAuthenticated)
        {
            // We check if company details are tied to user
            bool isTied = _daoFetcher.CompanyDao().userTiedToCompany(auth.GetAuthenticationStateAsync().Result.User.Identity.Name);
        
            Console.WriteLine("Is tied to company: " + isTied);
            
            // If not tied, redirect to page where they can create company and tie it to user
        }
    }

    public void test()
    {
        _daoFetcher.CompanyDao().getCompanyById(1);
        
        Console.WriteLine(_daoFetcher.CompanyDao().getCustomers().Count);
    }

}